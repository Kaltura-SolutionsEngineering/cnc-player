<!DOCTYPE HTML>
<html>

<head>
  <script type="text/javascript" src="https://cdnapisec.kaltura.com/p/{{env.partnerId}}/embedPlaykitJs/uiconf_id/{{env.cncUiconfId}}"></script>
  <style>
    .kep-linkify-message {
      font-family: cursive;
    }
  </style>
</head>

<body>
  <script defer>
    function loadCnc(options) {
      console.log(options);
      const floaterConfig = {
        "consent": {
          "legalTextUrls": [],
          "defaultSettings": {
            "receiveNotifications": true,
            "showFullName": true,
            "allowChatAndCollaboration": true
          },
          "cookieConsent": true
        },
        "server": {
          "jwtToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IjQ1NzQwNzMifQ.eyJwYXJ0bmVySWQiOiI0NTc0MDczIiwidWlkIjoiaGFubmFoLmtyYXVzQGthbHR1cmEuY29tIiwiZ3JvdXBzIjpbXSwiZXhwIjoxNjc5Mzg4NDE1LCJpc0FkbWluIjpmYWxzZSwidmlydHVhbEV2ZW50SWQiOjEyNzc1NzEsImlzU2NvcGVkVXNlciI6dHJ1ZSwiaWF0IjoxNjc5MzAyMDE1fQ.v4U8xK52x_PGJ0zPxaMjUkLvnmJSK7hC048T_H5Z5Bg",
          "serviceUrl": "https:\/\/chat.nvp1.ovp.kaltura.com\/api_v3"
        },
        "theme": {
          "Common": {
            "FontFamily": "cursive"
          }
        },
        "ui": {
          "toastTimeout": "5000",
          "toastPlayerUiconf": {{env.cncUiconfId}},
          "zIndex": 999,
          "position": {
            "right": "24px"
          },
          "locale": "en",
          "groupChat": {
            "enabled": true,
            "mode": "groupChat",
            "reactions": true,
            "reply": true
          },
          "instanceOptions": {
            "enableChat": true,
            "enableSearch": true
          }
        },
        "helpLink": "\/help",
        "moderation": {
          "moderatorUrl": `https://{{env.partnerId}}.mediaspace.kaltura.com/user/authenticate/ks/djJ8NDU3NDA3M3zfMZK0aAgzD2gWrfg3qd1-fdY5XWWgjkJIizKOLk3gt3hk1l3HPIN5gYLeq3hcDVqBw0nMFeFykg7iRh3Ig4pYEDjogQsqoS7RpyZG2cuJvoIF8AVcVrp-D6JKzBCSsDE4ca3qRydjWCKD3dsaS5cv`,
          "ui": {
            "label": "",
            "thumbnailUrl": `https://cfvod.kaltura.com/p/{{env.partnerId}}/thumbnail/{{env.defaultEntryId}}/1_2qbnfp3s/width/36/height/36/type/3`,
            "message": "keynote",
            "name": "Keynote 2023",
            "ctaButton": {
              "type": "",
              "label": ""
            }
          }
        }
        //  "reactions": {
        //   "mode": "available",
        //   "sourceUrl": "https:\/\/cdnapisec.kaltura.com\/p\/4574073\/embedPlaykitJs\/uiconf_id\/48975383",
        //   "endpointUrl": "https:\/\/analytics.kaltura.com",
        //   "ks": "djJ8NDU3NDA3M3yF6NMG984fAg9DIK_gFj_kKoJTppfxTyH1il03wIQgevAwOTtwe-821r502JQ7vPCmISwB5EGVnioCBCe1_PCHSslMrfgW9Thoy1hsb54El1w-esAQXdzRRXSNvnhcK7kRpq04dbTyMZQWRWoFPvE9"
        // }
      };

      function initiateFloater() {
        floater = KalturaEventsPlatform.collaboration.widgets.floater.new(floaterConfig);
        floater.render();
      }
      initiateFloater();

    }
    
    async function initData() {
      
      var data = await fetch("http://localhost:9005/embed-cnc/init-data");
      cncConfig = await data.json();
      // TODO .. get data from the server ( everything needed to run loadCnc() )
      // GET http://localhost:9005/embed-cnc/init-data
      // result ---> { "ks":"djJ8NDU3NDA3M3wtRN11r_Hq0TfhykuT-hbyzxw9FaHt4D9ljsDkAuRWR-_yZQksBuwBvNyl6yFOuiFrDoilqv8h_0k5AfkMSx3I7VJ2WItZWubDYCeMXmfKZ0DSRSDeq19peRWiXOqcBfqH8jAUQPQGl6J2N0ARJLBy","jwt":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IjQ1NzQwNzMifQ.eyJwYXJ0bmVySWQiOiI0NTc0MDczIiwidWlkIjoiaGFubmFoLmtyYXVzQGthbHR1cmEuY29tIiwiZ3JvdXBzIjpbXSwiZXhwIjoxNjc4MTk0NzE1LCJpc0FkbWluIjpmYWxzZSwidmlydHVhbEV2ZW50SWQiOjEyNzc1NzEsImlzU2NvcGVkVXNlciI6dHJ1ZSwiaWF0IjoxNjc4MTA4MzE1fQ.J6f7YNADkL3A6jDKZeznaVeD-2nRAORpTl2N76hfWpg","success":true }
      loadCnc(cncConfig);
    }
    initData()
  </script>
  <div id="kaltura_player_204830229" style="width: 560px;height: 395px"></div>
  <script type="text/javascript" src="https://cdnapisec.kaltura.com/p/{{env.partnerId}}/embedPlaykitJs/uiconf_id/{{env.playerUiconfId}}"></script>
  <script type="text/javascript">
  try {
    var kalturaPlayer = KalturaPlayer.setup({
      targetId: "kaltura_player_204830229",
      provider: {
        partnerId: {{env.partnerId}},
        uiConfId: {{env.playerUiconfId}}
      }
    });
    kalturaPlayer.loadMedia({entryId: '1_2qbnfp3s'});
  } catch (e) {
    console.error(e.message)
  }
</script>
</body>

</html>